# ScholarLens Brainstorming 文档

> 创建时间：2026-02-06
> 状态：设计方案待选择

---

## 1. 理解总结

| 维度 | 内容 |
|------|------|
| **产品名称** | ScholarLens |
| **定位** | 厦门中考冲刺错题管理系统 |
| **目标用户** | 九年级学生（2026年6月中考，剩余约4个月） |
| **核心痛点** | 错题散落在试卷上，无法系统复习，复习时找不到重点 |

### 用户模型
- 邀请码注册（控制访问）
- 家长与孩子共用同一账号
- 账号间数据完全隔离（RLS）
- 可分享给朋友家庭使用

### 科目优先级
1. 🥇 数学（150分）— MVP 必须支持
2. 🥈 语文（150分）— MVP 争取支持
3. 🥉 化学（60分）— 理科，复用数学逻辑
4. 4️⃣ 物理（90分）— 理科，复用数学逻辑

### 使用场景优先级
1. **考后录入**：每次考试后拍照上传错题
2. **考前刷题**：针对薄弱点生成变式题
3. **周末复习**：查看仪表盘了解整体情况

---

## 2. MVP 范围

### ✅ 必须做
| 功能 | 说明 |
|------|------|
| 邀请码注册 | 控制谁能使用系统 |
| 拍照上传 | 手机拍照上传试卷/错题 |
| AI 识别 | Gemini 识别题目内容、几何图形、公式 |
| 自动归类 | 知识点标签 + 错因分析 |
| 变式题生成 | "同构不同数"练习题 |
| 薄弱点仪表盘 | 雷达图展示知识点掌握度 |

### ⏳ 架构预留（不编码）
| 功能 | 说明 |
|------|------|
| 知识点趋势图 | 数据库预留时间戳，后续可做趋势分析 |
| 全科扩展 | Schema 设计支持所有科目 |

### ❌ 明确不做
- 家长/孩子角色分离
- 教师/班级系统
- 体育科目
- 多语言支持

---

## 3. 约束条件

| 约束 | 内容 |
|------|------|
| **时间** | 2-3 周内上线 MVP |
| **技术栈** | Next.js 15 + Supabase + Gemini/DeepSeek（已定） |
| **部署** | Zeabur（中国可访问） |
| **网络** | 后端可访问 Google API |

---

## 4. 假设清单

| 假设 | 验证状态 |
|------|----------|
| 用户主要用手机拍照上传 | ✅ 已确认 |
| AI 偶尔识别错误可接受，用户可手动修正 | ⚠️ 待验证 |
| 每次上传 1-5 道错题 | ⚠️ 待验证 |
| 变式题由 AI 生成，不需要题库 | ✅ 已确认 |

---

## 5. 设计方案

### 方案 A：极简 MVP（推荐 ⭐）

**核心理念**：用最少的代码，最快上线，验证核心价值

```
用户流程：
拍照 → 上传 → AI分析 → 查看结果 → 生成变式题
```

| 特点 | 说明 |
|------|------|
| 单页应用 | 首页即工作台，减少导航 |
| 即时反馈 | 上传后 10 秒内显示分析结果 |
| 最少 UI | 仪表盘只做雷达图，不做复杂统计 |

**开发时间**：约 2 周

**优点**：
- 最快上线
- 核心功能验证
- 易于迭代

**缺点**：
- 功能较少
- 用户体验可能粗糙

---

### 方案 B：标准 MVP

**核心理念**：在时间允许内，做一个相对完整的产品

```
页面结构：
├── 首页（仪表盘）
├── 上传页（拍照/选图）
├── 错题本（按科目/知识点浏览）
├── 练习页（变式题）
└── 设置页（账号管理）
```

| 特点 | 说明 |
|------|------|
| 完整导航 | 清晰的页面结构 |
| 错题浏览 | 支持按知识点筛选 |
| 历史记录 | 可查看过往错题 |

**开发时间**：约 3 周

**优点**：
- 功能更完整
- 用户体验更好
- 更接近正式产品

**缺点**：
- 开发时间更长
- 可能延误上线

---

### 方案 C：分阶段交付

**核心理念**：先上线核心功能，边用边迭代

| 阶段 | 时间 | 功能 |
|------|------|------|
| **Phase 1** | 第 1 周 | 拍照 + AI 分析 + 归类（纯功能，简陋 UI） |
| **Phase 2** | 第 2 周 | 仪表盘 + 变式题生成 |
| **Phase 3** | 第 3 周 | 错题浏览 + UI 美化 |

**优点**：
- 第 1 周就能开始用
- 根据实际使用反馈调整优先级
- 风险分散

**缺点**：
- 早期版本用户体验差
- 需要多次部署

---

## 6. 决策日志

| 决策 | 备选方案 | 选择原因 |
|------|----------|----------|
| 数学优先 | 全科同时开发 | 时间紧迫，数学分值最高 |
| 家庭共用账号 | 家长/孩子分离 | 简化开发，满足核心需求 |
| 邀请码注册 | 开放注册 | 控制使用范围，私密分享 |
| Gemini 做 OCR | 第三方 OCR | Gemini 擅长数学图形识别 |
| 趋势图暂缓 | MVP 包含 | YAGNI，架构预留即可 |

---

## 7. 最终决策

> ✅ 用户选择：**方案 B - 标准 MVP**

理由：虽然开发时间稍长（3周），但能提供完整的用户体验和清晰的页面结构，更适合作为可持续迭代的产品基础。

---

## 8. 专项讨论：进步追踪与知识点维度 (Brainstorming: Growth & KPs)

### 问题 1：如何看到进步？
**背景**：目前系统支持“纠正”错题，但缺乏时间维度的可视化。
**提议：【进步趋势图 (Growth Chart)】**
- **数据来源**：利用 `mistakes.corrected_at` 或 `questions.created_at`。
- **展现形式**：周/月维度的多折线图（或堆叠面积图）。
    - 曲线 A：**累计收录错题数**（总量控制）。
    - 曲线 B：**累计纠正错题数**（执行力指标）。
    - 比例 C：**实时掌握率** (B/A)。
- **心理暗示**：当 B 曲线不断逼近 A 曲线，用户能直观感受到“消灭敌人”的成就感。

### 问题 2：知识点分类追踪？
**背景**：用户担心错题只是堆砌，没有深度分析。
**提议：【薄弱点全景分析 (KP Insights)】**
- **核心逻辑**：不仅看“错过几次”，更要看“掌握程度”。
- **分级模型**：
    - 🔴 **高危区 (Critical)**：收录 3 次以上且未纠正（核心死穴）。
    - 🟡 **成长区 (Improving)**：曾经错过，但在变式练习中连续 2 次做对。
    - 🟢 **安全区 (Safe)**：已纠正且对应的变式题全对。
- **错因关联**：分析“正向迁移”，例如：如果“圆-垂径定理”总是因为“计算错误”而错，系统应提示“需注意代数运算而非几何模型”。

### 后续排期建议
1. **短期 (MVP+)**：在首页雷达图下方增加一个简单的“掌握率周趋势图”。
2. **中期 (Phase 4)**：开发专门的“复盘报告”页面，按知识点展示消灭进度。
3. **长期**：AI 自动根据 KP 掌握情况，动态调整练习页面的题目权重（越弱的知识点出现频率越高）。

---

## 9. 专项讨论：错题形式与输入支持 (Problem Types & Input)

### 现状分析
目前系统假设用户上传的是**“原题+答题痕迹”在同一张图**上的内容（Case 2：平时作业）。
- **Case 1 (试卷+答题卡)**：正式考试中，题目在试卷上，红叉在答题卡上。
    - **挑战**：用户需要上传两张图（试卷题目图 + 答题卡错题图），或者 AI 需要仅凭答题卡上的红叉推断（但这无法通过 RAG 搜题，因为答题卡上只有选项或手写步骤，没有题干）。
- **Case 2 (同卷作答)**：平时作业，题目和批改都在一起。
    - **现状**：目前 Prompt 能够很好地处理。

### 解决方案提议

#### 方案 A：单图流（当前 MVP）
- 强行要求用户：**“请对着试卷题目拍照，如果错题在答题卡上，请将答题卡放在试卷对应位置一起拍”**。
- **优点**：开发量小，交互简单。
- **缺点**：操作麻烦，用户体验一般。

#### 方案 B：通用多图上传 (Universal Multi-Image Upload) - **Priority: High**

**核心逻辑**：不再强制区分“题”与“答”，而是支持**“上下文图集 (Context Images)”**。用户可以上传 1-10 张图片，AI 自动从中提取所有错题。

**场景覆盖**：
1.  **Case 1 (分离)**：图1是试卷题干，图2是答题卡。
2.  **Case 2 (多页)**：作业有 3 页（正反面），用户连拍 3 张。
3.  **Case 3 (混合)**：试卷头部有题干，用户又拍了一张手写草稿纸。

**交互流程设计**：
1.  **统一上传区**：
    *   一个大的 Dropzone，支持拖入多张图片或 PDF。
    *   支持**批量预览**和**顺序调整**（虽然 Gemini 不太依赖顺序，但对用户心理有帮助）。
2.  **（可选）源标记**：
    *   用户在上传后，可以简单的标记每一张图是“试卷”还是“答题/草稿”（非必须，AI 可自推断）。
3.  **处理逻辑**：
    *   后端接收 `files: File[]`。
    *   Gemini Prompt 调整为：“你将收到一组图片（共 N 张）。请综合阅读所有图片内容。这些图片可能包含完整的试卷、答题卡或草稿。请在所有图片中寻找**被标记为错误**（红叉/圈选）的题目，并提取其对应的题干和正确解析。如果错题在答题卡上，请自动在其他图片中寻找对应题号的题干。”

**技术实现路径**：
*   **前端**：改造 `Current Upload` 组件，支持多选文件、预览列表、删除单张。
*   **后端**：
    *   Service 接口改造：支持接收 `FormData` 中的多文件数组。
    *   Prompt 升级：利用 Gemini 1.5 Pro 的 `High Context Window`，一次性传入所有 Image Parts。
*   **数据存储**：
    *   `questions` 表字段扩展：`source_images` (JSONB array) 存储所有相关图片 URL。

### 决策建议
- **立即执行**：在 MVP 测试结束后，**优先开发通用多图上传功能**。这是解决所有真实场景（不论是 A3/A4 正反面，还是试卷+答题卡）的终极方案。
